<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ™‚é–“é­”æ³•å¸« 3.0</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">
  <div class="container py-4">
    <h2 class="text-center mb-4">æ™‚é–“é­”æ³•å¸« 3.0</h2>

    <!-- è¼¸å…¥å€å¡Š -->
    <div class="card mb-4">
      <div class="card-body">
        <h5>è¼¸å…¥ä»Šæ—¥ä»»å‹™</h5>
        <div class="mb-2">
          <input id="taskName" class="form-control mb-2" placeholder="ä»»å‹™åç¨±">
          <input id="taskTime" class="form-control mb-2" placeholder="æ‰€éœ€æ™‚é–“ï¼ˆåˆ†é˜ï¼‰" type="number">
          <button class="btn btn-primary" onclick="addTask()">æ–°å¢ä»»å‹™</button>
        </div>
        <ul id="taskList" class="list-group"></ul>
      </div>
    </div>

    <!-- åŸ·è¡Œæ§åˆ¶å€ -->
    <div class="mb-4">
      <button class="btn btn-success" onclick="startSchedule()">é–‹å§‹åŸ·è¡Œä»»å‹™</button>
    </div>

    <!-- å¿ƒæƒ…è¼¸å…¥å€ -->
    <div class="card mb-4">
      <div class="card-body">
        <h5>è«‹è¼¸å…¥ä»Šæ—¥å¿ƒæƒ…ï¼ˆ1~5ï¼‰</h5>
        <input id="moodInput" type="number" min="1" max="5" class="form-control mb-2">
        <button class="btn btn-secondary" onclick="saveMood()">å„²å­˜å¿ƒæƒ…</button>
      </div>
    </div>

    <!-- åˆ†æåœ–å€ -->
    <div>
      <h5>ğŸ“Š ä»Šæ—¥æ™‚é–“åˆ†æåœ–</h5>
      <canvas id="timeChart"></canvas>
    </div>
    <div class="mt-4">
      <h5>ğŸ“ˆ å¿ƒæƒ…é€±å ±</h5>
      <button class="btn btn-info" onclick="generateMoodReport()">ç”¢ç”Ÿä¸€é€±çµ±è¨ˆ</button>
      <div id="moodReport" class="mt-2"></div>
    </div>
  </div>

  <script>
    let tasks = [];
    let moodData = JSON.parse(localStorage.getItem('moods')) || [];

    function addTask() {
      const name = document.getElementById('taskName').value;
      const time = parseInt(document.getElementById('taskTime').value);
      if (!name || !time) return alert('è«‹å¡«å…¥ä»»å‹™èˆ‡æ™‚é–“');
      tasks.push({ name, time });
      updateTaskList();
      document.getElementById('taskName').value = '';
      document.getElementById('taskTime').value = '';
    }

    function updateTaskList() {
      const list = document.getElementById('taskList');
      list.innerHTML = '';
      tasks.forEach((task, i) => {
        const li = document.createElement('li');
        li.className = 'list-group-item';
        li.textContent = `${task.name} - ${task.time}åˆ†é˜`;
        list.appendChild(li);
      });
    }

    function startSchedule() {
      if (!tasks.length) return alert('è«‹å…ˆæ–°å¢ä»»å‹™');
      runNextTask(0);
    }

    function runNextTask(index) {
      if (index >= tasks.length) {
        alert('ğŸ‰ ä»»å‹™å…¨éƒ¨å®Œæˆï¼');
        generateChart();
        return;
      }
      const task = tasks[index];
      showNotification(`é–‹å§‹ä»»å‹™ï¼š${task.name}`);
      setTimeout(() => {
        showNotification(`å®Œæˆä»»å‹™ï¼š${task.name}`);
        runNextTask(index + 1);
      }, task.time * 60 * 1000); // å–®ä½æ˜¯æ¯«ç§’
    }

    function showNotification(text) {
      alert(text); // è¦–çª—è·³å‡ºé€šçŸ¥ï¼ˆå¯æ”¹ç”¨ Notification APIï¼‰
    }

    function generateChart() {
      const ctx = document.getElementById('timeChart').getContext('2d');
      const labels = tasks.map(t => t.name);
      const data = tasks.map(t => t.time);
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'æ™‚é–“ï¼ˆåˆ†é˜ï¼‰',
            data,
            backgroundColor: 'rgba(75, 192, 192, 0.5)'
          }]
        }
      });
    }

    function saveMood() {
      const mood = parseInt(document.getElementById('moodInput').value);
      if (mood < 1 || mood > 5) return alert('è«‹è¼¸å…¥ 1~5');
      moodData.push({ date: new Date().toLocaleDateString(), mood });
      localStorage.setItem('moods', JSON.stringify(moodData));
      alert('å·²å„²å­˜ä»Šæ—¥å¿ƒæƒ…');
    }

    function generateMoodReport() {
      if (moodData.length === 0) return alert('å°šç„¡å¿ƒæƒ…è³‡æ–™');
      const recent = moodData.slice(-7);
      const avg = (recent.reduce((sum, m) => sum + m.mood, 0) / recent.length).toFixed(2);
      const report = `ğŸ“… å¹³å‡å¿ƒæƒ…ï¼š${avg}<br>ğŸ“ è¨˜éŒ„å¤©æ•¸ï¼š${recent.length} å¤©`;
      document.getElementById('moodReport').innerHTML = report;
    }
  </script>
</body>
</html>
